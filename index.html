<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlogHub | Share Your Stories</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS Variables */
        :root {
            --primary-bg: #0a0a1a;
            --secondary-bg: #15152b;
            --accent-color: #3498db;
            --accent-dark: #2980b9;
            --text-color: #ffffff;
            --text-secondary: #b0b0cc;
            --card-bg: #1e1e3a;
            --hover-color: #4aa8e8;
            --transition: all 0.3s ease;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --error-color: #e74c3c;
        }

        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--primary-bg);
            color: var(--text-color);
            line-height: 1.6;
        }

        a {
            text-decoration: none;
            color: var(--accent-color);
            transition: var(--transition);
        }

        button {
            cursor: pointer;
            border: none;
            outline: none;
            transition: var(--transition);
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Header Styles */
        header {
            background-color: var(--secondary-bg);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(52, 152, 219, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1 {
            font-size: 1.8rem;
            background: linear-gradient(to right, var(--accent-color), #4aa8e8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo i {
            color: var(--accent-color);
            font-size: 1.8rem;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 1.5rem;
        }

        nav a {
            color: var(--text-color);
            font-weight: 500;
            padding: 0.5rem 0;
            position: relative;
        }

        nav a:hover {
            color: var(--accent-color);
        }

        nav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--accent-color);
            transition: var(--transition);
        }

        nav a:hover::after {
            width: 100%;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            background-size: cover;
            background-position: center;
        }

        .logout-btn {
            background-color: transparent;
            color: var(--text-color);
            border: 1px solid var(--accent-color);
            padding: 0.5rem 1rem;
            border-radius: 4px;
        }

        .logout-btn:hover {
            background-color: var(--accent-color);
            color: var(--primary-bg);
        }

        .create-article-btn {
            background-color: var(--success-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            margin-right: 10px;
        }

        .create-article-btn:hover {
            background-color: #27ae60;
        }

        /* Mobile Menu */
        .mobile-menu-btn {
            display: none;
            background: none;
            color: var(--text-color);
            font-size: 1.5rem;
        }

        .mobile-nav {
            display: none;
            position: fixed;
            top: 70px;
            left: 0;
            width: 100%;
            background-color: var(--secondary-bg);
            padding: 1rem;
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
            z-index: 99;
        }

        .mobile-nav.active {
            display: block;
        }

        .mobile-nav ul {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .mobile-nav a {
            color: var(--text-color);
            padding: 0.5rem 0;
            display: block;
        }

        /* Main Content Styles */
        main {
            min-height: calc(100vh - 160px);
            padding: 2rem 0;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Login/Signup Page */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
        }

        .auth-card {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
            width: 100%;
            max-width: 450px;
            text-align: center;
        }

        .auth-card h2 {
            margin-bottom: 1.5rem;
            color: var(--accent-color);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #333;
        }

        .auth-tab {
            flex: 1;
            padding: 0.8rem;
            background: none;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .auth-tab.active {
            color: var(--accent-color);
            border-bottom: 2px solid var(--accent-color);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1rem;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 0.8rem;
            background-color: var(--secondary-bg);
            border: 1px solid #333;
            border-radius: 4px;
            color: var(--text-color);
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            border-color: var(--accent-color);
        }

        .auth-btn {
            width: 100%;
            padding: 0.8rem;
            background-color: var(--accent-color);
            color: var(--primary-bg);
            border-radius: 4px;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .auth-btn:hover {
            background-color: var(--hover-color);
        }

        .social-login {
            margin-top: 1.5rem;
            border-top: 1px solid #333;
            padding-top: 1.5rem;
        }

        .social-login p {
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        .social-buttons {
            display: flex;
            gap: 1rem;
        }

        .social-btn {
            flex: 1;
            padding: 0.8rem;
            border-radius: 4px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .google-btn {
            background-color: #db4437;
            color: white;
        }

        .facebook-btn {
            background-color: #4267B2;
            color: white;
        }

        .social-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* Home Page */
        .hero {
            text-align: center;
            padding: 3rem 0;
            background: linear-gradient(rgba(10,10,26,0.8), rgba(10,10,26,0.8)), url('https://images.unsplash.com/photo-1486312338219-ce68d2c6f44d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');
            background-size: cover;
            background-position: center;
            border-radius: 10px;
            margin-bottom: 2rem;
        }

        .hero h2 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 2rem;
            color: var(--text-secondary);
        }

        .cta-btn {
            background-color: var(--accent-color);
            color: var(--primary-bg);
            padding: 0.8rem 2rem;
            border-radius: 4px;
            font-weight: 600;
            display: inline-block;
        }

        .cta-btn:hover {
            background-color: var(--hover-color);
            transform: translateY(-3px);
        }

        .section-title {
            margin: 2rem 0 1.5rem;
            position: relative;
            padding-bottom: 0.5rem;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background-color: var(--accent-color);
        }

        .quote-of-day {
            background-color: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid var(--accent-color);
        }

        .quote-content {
            font-style: italic;
            margin-bottom: 0.5rem;
            color: var(--text-color);
        }

        .quote-author {
            text-align: right;
            color: var(--accent-color);
            font-weight: 500;
        }

        .categories {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .category {
            background-color: var(--card-bg);
            padding: 0.8rem 1.5rem;
            border-radius: 20px;
            font-weight: 500;
            transition: var(--transition);
        }

        .category:hover {
            background-color: var(--accent-color);
            color: var(--primary-bg);
            transform: translateY(-3px);
        }

        .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .article-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            transition: var(--transition);
        }

        .article-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.1);
        }

        .article-img {
            height: 180px;
            background-color: #333;
            background-size: cover;
            background-position: center;
        }

        .article-content {
            padding: 1.5rem;
        }

        .article-content h3 {
            margin-bottom: 0.5rem;
        }

        .article-meta {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .article-excerpt {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .article-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .read-more {
            color: var(--accent-color);
            font-weight: 500;
        }

        .read-more:hover {
            color: var(--hover-color);
        }

        .rating {
            display: flex;
            gap: 5px;
        }

        .star {
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }

        .star:hover, .star.active {
            color: var(--warning-color);
        }

        /* Create Article Page */
        .create-article-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .create-article-card {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
        }

        .create-article-card h2 {
            margin-bottom: 1.5rem;
            color: var(--accent-color);
        }

        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .form-group-full {
            margin-bottom: 1rem;
        }

        .form-group-full label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        .form-group-full textarea {
            width: 100%;
            padding: 0.8rem;
            background-color: var(--secondary-bg);
            border: 1px solid #333;
            border-radius: 4px;
            color: var(--text-color);
            resize: vertical;
            min-height: 200px;
        }

        .form-group-full textarea:focus {
            border-color: var(--accent-color);
        }

        .tags-input {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .tag {
            background-color: var(--secondary-bg);
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tag-remove {
            cursor: pointer;
            color: var(--error-color);
        }

        .tag-input {
            flex: 1;
            min-width: 100px;
            padding: 0.3rem;
            background-color: transparent;
            border: none;
            color: var(--text-color);
        }

        .tag-input:focus {
            outline: none;
        }

        .publish-btn {
            background-color: var(--success-color);
            color: white;
            padding: 0.8rem 2rem;
            border-radius: 4px;
            font-weight: 600;
            margin-top: 1rem;
        }

        .publish-btn:hover {
            background-color: #27ae60;
        }

        /* About Page */
        .about-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .writer-info {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .writer-photo {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background-color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: var(--accent-color);
            flex-shrink: 0;
            background-size: cover;
            background-position: center;
        }

        .writer-details {
            flex: 1;
        }

        .writer-details h2 {
            margin-bottom: 1rem;
            color: var(--accent-color);
        }

        .writer-details p {
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        .social-links-about {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .social-link-about {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--card-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-color);
            transition: var(--transition);
        }

        .social-link-about:hover {
            background-color: var(--accent-color);
            transform: translateY(-3px);
        }

        /* Articles Page */
        .search-bar {
            margin-bottom: 2rem;
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: 0.8rem 1rem 0.8rem 2.5rem;
            background-color: var(--secondary-bg);
            border: 1px solid #333;
            border-radius: 4px;
            color: var(--text-color);
        }

        .search-bar i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        /* Article Detail Page */
        .article-detail {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .article-header {
            margin-bottom: 1.5rem;
        }

        .article-title {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .article-meta-detail {
            display: flex;
            gap: 1rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .article-image {
            width: 100%;
            height: 400px;
            background-color: #333;
            background-size: cover;
            background-position: center;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .article-body {
            line-height: 1.8;
            margin-bottom: 2rem;
        }

        .article-body p {
            margin-bottom: 1rem;
        }

        .article-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .tag {
            background-color: var(--secondary-bg);
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        .article-actions-detail {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid #333;
        }

        .rating-detail {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .rating-stars {
            display: flex;
            gap: 5px;
        }

        .rating-count {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .comments-section {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 2rem;
        }

        .comments-title {
            margin-bottom: 1.5rem;
            color: var(--accent-color);
        }

        .comment-form {
            margin-bottom: 2rem;
        }

        .comment-input {
            width: 100%;
            padding: 1rem;
            background-color: var(--secondary-bg);
            border: 1px solid #333;
            border-radius: 4px;
            color: var(--text-color);
            margin-bottom: 1rem;
            resize: vertical;
            min-height: 100px;
        }

        .comment-submit {
            background-color: var(--accent-color);
            color: var(--primary-bg);
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            font-weight: 600;
        }

        .comment-submit:hover {
            background-color: var(--hover-color);
        }

        .comments-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .comment {
            padding: 1rem;
            background-color: var(--secondary-bg);
            border-radius: 8px;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .comment-author {
            font-weight: 600;
            color: var(--accent-color);
        }

        .comment-date {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .comment-text {
            color: var(--text-color);
        }

        /* Profile Page */
        .profile-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: bold;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .profile-avatar-upload {
            position: absolute;
            bottom: 0;
            right: 0;
            background-color: var(--accent-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .profile-details h2 {
            margin-bottom: 0.5rem;
        }

        .profile-details p {
            color: var(--text-secondary);
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat {
            text-align: center;
            padding: 1rem;
            background-color: var(--secondary-bg);
            border-radius: 8px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-color);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .profile-bio {
            margin-bottom: 2rem;
            padding: 1rem;
            background-color: var(--secondary-bg);
            border-radius: 8px;
        }

        .profile-bio h3 {
            margin-bottom: 0.5rem;
            color: var(--accent-color);
        }

        .profile-articles {
            margin-top: 2rem;
        }

        .profile-articles h3 {
            margin-bottom: 1rem;
            color: var(--accent-color);
        }

        /* Settings Page */
        .settings-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .settings-group {
            margin-bottom: 1.5rem;
        }

        .settings-group h3 {
            margin-bottom: 1rem;
            color: var(--accent-color);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #333;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #333;
            transition: var(--transition);
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--accent-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .logout-section {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #333;
        }

        .logout-btn-settings {
            background-color: var(--error-color);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            font-weight: 600;
        }

        .logout-btn-settings:hover {
            background-color: #c0392b;
        }

        /* Connect Page */
        .connect-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
        }

        .users-list {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 1.5rem;
            max-height: 600px;
            overflow-y: auto;
        }

        .users-list h3 {
            margin-bottom: 1rem;
            color: var(--accent-color);
        }

        .user-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 8px;
            transition: var(--transition);
            cursor: pointer;
        }

        .user-item:hover {
            background-color: var(--secondary-bg);
        }

        .user-item.active {
            background-color: var(--secondary-bg);
            border-left: 3px solid var(--accent-color);
        }

        .user-avatar-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            background-size: cover;
            background-position: center;
        }

        .user-details-small h4 {
            margin-bottom: 0.2rem;
        }

        .user-details-small p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .chat-container {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            height: 600px;
        }

        .chat-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #333;
            margin-bottom: 1rem;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            padding: 0.8rem 1rem;
            border-radius: 8px;
            max-width: 70%;
        }

        .message.sent {
            align-self: flex-end;
            background-color: var(--accent-color);
            color: white;
        }

        .message.received {
            align-self: flex-start;
            background-color: var(--secondary-bg);
        }

        .message-time {
            font-size: 0.8rem;
            margin-top: 0.3rem;
            opacity: 0.7;
        }

        .chat-input {
            display: flex;
            gap: 1rem;
        }

        .chat-input input {
            flex: 1;
            padding: 0.8rem;
            background-color: var(--secondary-bg);
            border: 1px solid #333;
            border-radius: 4px;
            color: var(--text-color);
        }

        .chat-send {
            background-color: var(--accent-color);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            font-weight: 600;
        }

        .chat-send:hover {
            background-color: var(--hover-color);
        }

        /* Footer Styles */
        footer {
            background-color: var(--secondary-bg);
            padding: 2rem 0;
            margin-top: 2rem;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
        }

        .social-links {
            display: flex;
            gap: 1.5rem;
        }

        .social-link {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--card-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-color);
            transition: var(--transition);
        }

        .social-link:hover {
            background-color: var(--accent-color);
            transform: translateY(-3px);
        }

        .copyright {
            color: var(--text-secondary);
            text-align: center;
        }

        /* New Styles for Enhanced Features */
        .follow-btn, .message-btn, .friend-btn {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-weight: 500;
            margin-right: 0.5rem;
        }

        .follow-btn {
            background-color: var(--accent-color);
            color: white;
        }

        .follow-btn:hover {
            background-color: var(--hover-color);
        }

        .follow-btn.following {
            background-color: var(--success-color);
        }

        .message-btn {
            background-color: transparent;
            color: var(--text-color);
            border: 1px solid var(--accent-color);
        }

        .message-btn:hover {
            background-color: var(--accent-color);
            color: white;
        }

        .friend-btn {
            background-color: var(--warning-color);
            color: white;
        }

        .friend-btn:hover {
            background-color: #e67e22;
        }

        .friend-btn.requested {
            background-color: var(--text-secondary);
        }

        .user-actions {
            display: flex;
            margin-top: 1rem;
        }

        .suggestions-section {
            margin-top: 2rem;
        }

        .suggestions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .suggestion-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
        }

        .suggestion-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0 auto 1rem;
            background-size: cover;
            background-position: center;
        }

        .suggestion-stats {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1rem 0;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .engagement-metrics {
            display: flex;
            justify-content: space-between;
            margin: 1rem 0;
            padding: 0.5rem 0;
            border-top: 1px solid #333;
            border-bottom: 1px solid #333;
        }

        .metric {
            text-align: center;
        }

        .metric-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent-color);
        }

        .metric-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .comment-rating {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .comment-stars {
            display: flex;
            gap: 2px;
        }

        .comment-star {
            color: var(--warning-color);
            font-size: 0.9rem;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--error-color);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-item-with-badge {
            position: relative;
        }

        /* Friend Requests Section */
        .friend-requests-section {
            margin-top: 2rem;
        }

        .friend-requests-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1rem;
        }

        .friend-request-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background-color: var(--card-bg);
            border-radius: 8px;
        }

        .friend-request-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .friend-request-actions {
            display: flex;
            gap: 0.5rem;
        }

        .accept-btn {
            background-color: var(--success-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
        }

        .decline-btn {
            background-color: var(--error-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
        }

        /* Profile Picture Upload */
        .profile-picture-upload {
            display: none;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            nav ul {
                display: none;
            }

            .mobile-menu-btn {
                display: block;
            }

            .writer-info {
                flex-direction: column;
                text-align: center;
            }

            .writer-photo {
                width: 150px;
                height: 150px;
                font-size: 3rem;
            }

            .hero h2 {
                font-size: 2rem;
            }

            .hero p {
                font-size: 1rem;
            }

            .profile-header {
                flex-direction: column;
                text-align: center;
            }

            .profile-stats {
                grid-template-columns: 1fr;
            }

            .connect-container {
                grid-template-columns: 1fr;
            }

            .message {
                max-width: 85%;
            }

            .suggestions-grid {
                grid-template-columns: 1fr;
            }

            .user-actions {
                flex-direction: column;
                gap: 0.5rem;
            }

            .follow-btn, .message-btn, .friend-btn {
                margin-right: 0;
                width: 100%;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-blog"></i>
                <h1>BlogHub</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="nav-link" data-page="home">Home</a></li>
                    <li><a href="#" class="nav-link" data-page="about">About Us</a></li>
                    <li><a href="#" class="nav-link" data-page="articles">Articles</a></li>
                    <li><a href="#" class="nav-link" data-page="create-article">Write</a></li>
                    <li class="nav-item-with-badge">
                        <a href="#" class="nav-link" data-page="connect">Connect</a>
                        <span class="notification-badge" id="messageNotification" style="display: none;">0</span>
                    </li>
                    <li class="nav-item-with-badge">
                        <a href="#" class="nav-link" data-page="friends">Friends</a>
                        <span class="notification-badge" id="friendRequestNotification" style="display: none;">0</span>
                    </li>
                    <li><a href="#" class="nav-link" data-page="profile">Profile</a></li>
                    <li><a href="#" class="nav-link" data-page="settings">Settings</a></li>
                </ul>
            </nav>
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            <div class="user-info" id="userInfo">
                <button class="create-article-btn" id="createArticleBtn">Write</button>
                <div class="user-avatar" id="userAvatar">U</div>
                <button class="logout-btn" id="logoutBtn">Logout</button>
            </div>
        </div>
        <div class="mobile-nav" id="mobileNav">
            <ul>
                <li><a href="#" class="nav-link" data-page="home">Home</a></li>
                <li><a href="#" class="nav-link" data-page="about">About Us</a></li>
                <li><a href="#" class="nav-link" data-page="articles">Articles</a></li>
                <li><a href="#" class="nav-link" data-page="create-article">Write</a></li>
                <li class="nav-item-with-badge">
                    <a href="#" class="nav-link" data-page="connect">Connect</a>
                    <span class="notification-badge" id="mobileMessageNotification" style="display: none;">0</span>
                </li>
                <li class="nav-item-with-badge">
                    <a href="#" class="nav-link" data-page="friends">Friends</a>
                    <span class="notification-badge" id="mobileFriendRequestNotification" style="display: none;">0</span>
                </li>
                <li><a href="#" class="nav-link" data-page="profile">Profile</a></li>
                <li><a href="#" class="nav-link" data-page="settings">Settings</a></li>
            </ul>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Login/Signup Page -->
        <section id="auth" class="page active">
            <div class="container auth-container">
                <div class="auth-card">
                    <h2>Welcome to BlogHub</h2>
                    <div class="auth-tabs">
                        <button class="auth-tab active" data-tab="login">Login</button>
                        <button class="auth-tab" data-tab="signup">Sign Up</button>
                    </div>
                    
                    <form id="loginForm" class="auth-form active">
                        <div class="form-group">
                            <label for="loginEmail">Email</label>
                            <input type="email" id="loginEmail" placeholder="Enter your email">
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Password</label>
                            <input type="password" id="loginPassword" placeholder="Enter your password">
                        </div>
                        <button type="submit" class="auth-btn">Login</button>
                    </form>
                    
                    <form id="signupForm" class="auth-form">
                        <div class="form-group">
                            <label for="signupName">Full Name</label>
                            <input type="text" id="signupName" placeholder="Enter your full name">
                        </div>
                        <div class="form-group">
                            <label for="signupEmail">Email</label>
                            <input type="email" id="signupEmail" placeholder="Enter your email">
                        </div>
                        <div class="form-group">
                            <label for="signupPassword">Password</label>
                            <input type="password" id="signupPassword" placeholder="Create a password">
                        </div>
                        <div class="form-group">
                            <label for="signupBio">Bio (Optional)</label>
                            <textarea id="signupBio" placeholder="Tell us about yourself" rows="3"></textarea>
                        </div>
                        <button type="submit" class="auth-btn">Sign Up</button>
                    </form>
                    
                    <div class="social-login">
                        <p>Or continue with</p>
                        <div class="social-buttons">
                            <button class="social-btn google-btn" id="googleLogin">
                                <i class="fab fa-google"></i> Google
                            </button>
                            <button class="social-btn facebook-btn" id="facebookLogin">
                                <i class="fab fa-facebook-f"></i> Facebook
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Home Page -->
        <section id="home" class="page">
            <div class="container">
                <div class="hero">
                    <h2>Share Your Stories with the World</h2>
                    <p>BlogHub is your platform to express ideas, share experiences, and connect with like-minded readers and writers.</p>
                    <a href="#" class="cta-btn nav-link" data-page="articles">Explore Articles</a>
                </div>
                
                <div class="quote-of-day">
                    <p class="quote-content">"The only way to do great work is to love what you do."</p>
                    <p class="quote-author">- Steve Jobs</p>
                </div>
                
                <h2 class="section-title">Categories</h2>
                <div class="categories">
                    <div class="category">Technology</div>
                    <div class="category">Lifestyle</div>
                    <div class="category">Travel</div>
                    <div class="category">Food</div>
                    <div class="category">Health</div>
                    <div class="category">Business</div>
                    <div class="category">Entertainment</div>
                    <div class="category">Science</div>
                </div>
                
                <h2 class="section-title">Featured Articles</h2>
                <div class="articles-grid" id="featuredArticles">
                    <!-- Featured articles will be dynamically loaded here -->
                </div>

                <!-- User Suggestions for First-Time Users -->
                <div class="suggestions-section" id="suggestionsSection" style="display: none;">
                    <h2 class="section-title">People You May Know</h2>
                    <p>Connect with other writers and readers to expand your network.</p>
                    <div class="suggestions-grid" id="suggestionsGrid">
                        <!-- User suggestions will be dynamically loaded here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Create Article Page -->
        <section id="create-article" class="page">
            <div class="container create-article-container">
                <div class="create-article-card">
                    <h2>Create New Article</h2>
                    <form id="createArticleForm">
                        <div class="form-group">
                            <label for="articleTitle">Title</label>
                            <input type="text" id="articleTitle" placeholder="Enter article title">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="articleCategory">Category</label>
                                <select id="articleCategory">
                                    <option value="">Select Category</option>
                                    <option value="Technology">Technology</option>
                                    <option value="Lifestyle">Lifestyle</option>
                                    <option value="Travel">Travel</option>
                                    <option value="Food">Food</option>
                                    <option value="Health">Health</option>
                                    <option value="Business">Business</option>
                                    <option value="Entertainment">Entertainment</option>
                                    <option value="Science">Science</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="articleImage">Featured Image URL</label>
                                <input type="text" id="articleImage" placeholder="Enter image URL">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="articleExcerpt">Excerpt</label>
                            <textarea id="articleExcerpt" placeholder="Brief description of your article" rows="3"></textarea>
                        </div>
                        
                        <div class="form-group-full">
                            <label for="articleContent">Content</label>
                            <textarea id="articleContent" placeholder="Write your article content here..." rows="15"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="articleTags">Tags</label>
                            <div class="tags-input" id="tagsContainer">
                                <input type="text" id="articleTags" class="tag-input" placeholder="Add tags...">
                            </div>
                            <div id="tagsList" class="tags-input"></div>
                        </div>
                        
                        <button type="submit" class="publish-btn">Publish Article</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- About Us Page -->
        <section id="about" class="page">
            <div class="container">
                <h2 class="section-title">About Us</h2>
                <div class="about-content">
                    <div class="writer-info">
                        <div class="writer-photo">
                             <img src="image/rabi.jpg" alt="Description of image" width="250" height="250">
                        </div>
                        <div class="writer-details">
                            <h2>Rabi</h2>
                            <p>Rabi is a passionate writer and content creator with over 1 years of experience in the blogging industry. With a background in arts and digital marketing, Rabi brings a unique perspective to every piece of content.</p>
                            <p>When not writing, Rabi enjoys photography, hiking, and exploring new coffee shops around the city. The goal is to create a community where ideas can be shared freely and creativity can flourish.</p>
                            <p>Through BlogHub, Rabi hopes to inspire others to share their stories and connect with a global audience of readers and writers.</p>
                            
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Articles Page -->
        <section id="articles" class="page">
            <div class="container">
                <h2 class="section-title">All Articles</h2>
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search articles...">
                </div>
                <div class="articles-grid" id="allArticles">
                    <!-- All articles will be dynamically loaded here -->
                </div>
            </div>
        </section>

        <!-- Article Detail Page -->
        <section id="article-detail" class="page">
            <div class="container">
                <div class="article-detail">
                    <div class="article-header">
                        <h1 class="article-title" id="detailTitle">Article Title</h1>
                        <div class="article-meta-detail">
                            <span id="detailAuthor">Author Name</span>
                            <span id="detailDate">May 15, 2023</span>
                            <span id="detailCategory">Technology</span>
                        </div>
                        <div class="engagement-metrics">
                            <div class="metric">
                                <div class="metric-value" id="detailReadCount">0</div>
                                <div class="metric-label">Reads</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value" id="detailLikeCount">0</div>
                                <div class="metric-label">Likes</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value" id="detailCommentCount">0</div>
                                <div class="metric-label">Comments</div>
                            </div>
                        </div>
                    </div>
                    <div class="article-image" id="detailImage"></div>
                    <div class="article-body" id="detailBody">
                        <!-- Article content will be dynamically loaded here -->
                    </div>
                    <div class="article-tags" id="detailTags">
                        <!-- Tags will be dynamically loaded here -->
                    </div>
                    <div class="article-actions-detail">
                        <div class="rating-detail">
                            <div class="rating-stars" id="detailRating">
                                <!-- Rating stars will be dynamically loaded here -->
                            </div>
                            <div class="rating-count" id="detailRatingCount">(0 ratings)</div>
                        </div>
                        <div class="share-buttons">
                            <button class="share-btn"><i class="fas fa-share-alt"></i> Share</button>
                            <button class="like-btn" id="likeBtn"><i class="far fa-heart"></i> Like</button>
                        </div>
                    </div>
                </div>
                
                <div class="comments-section">
                    <h3 class="comments-title">Comments</h3>
                    <div class="comment-form">
                        <textarea class="comment-input" id="commentInput" placeholder="Add your comment..."></textarea>
                        <div class="comment-rating">
                            <span>Rate this article:</span>
                            <div class="comment-stars" id="commentRating">
                                <i class="far fa-star comment-star" data-rating="1"></i>
                                <i class="far fa-star comment-star" data-rating="2"></i>
                                <i class="far fa-star comment-star" data-rating="3"></i>
                                <i class="far fa-star comment-star" data-rating="4"></i>
                                <i class="far fa-star comment-star" data-rating="5"></i>
                            </div>
                        </div>
                        <button class="comment-submit" id="commentSubmit">Post Comment</button>
                    </div>
                    <div class="comments-list" id="commentsList">
                        <!-- Comments will be dynamically loaded here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Connect Page -->
        <section id="connect" class="page">
            <div class="container">
                <h2 class="section-title">Connect with Readers</h2>
                <div class="connect-container">
                    <div class="users-list">
                        <h3>Active Users</h3>
                        <div class="users-container" id="usersContainer">
                            <!-- Users will be dynamically loaded here -->
                        </div>
                    </div>
                    <div class="chat-container">
                        <div class="chat-header">
                            <div class="user-avatar-small" id="chatUserAvatar">U</div>
                            <div class="user-details-small">
                                <h4 id="chatUserName">Select a user to chat</h4>
                                <p id="chatUserStatus">Online</p>
                            </div>
                        </div>
                        <div class="chat-messages" id="chatMessages">
                            <!-- Messages will be dynamically loaded here -->
                        </div>
                        <div class="chat-input">
                            <input type="text" id="chatInput" placeholder="Type a message..." disabled>
                            <button class="chat-send" id="chatSend" disabled>Send</button>
                        </div>
                    </div>
                </div>

                <!-- Followed Users Section -->
                <div class="suggestions-section" style="margin-top: 3rem;">
                    <h2 class="section-title">People You Follow</h2>
                    <div class="suggestions-grid" id="followedUsersGrid">
                        <!-- Followed users will be dynamically loaded here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Friends Page -->
        <section id="friends" class="page">
            <div class="container">
                <h2 class="section-title">Friends</h2>
                
                <div class="friend-requests-section">
                    <h3>Friend Requests</h3>
                    <div class="friend-requests-list" id="friendRequestsList">
                        <!-- Friend requests will be dynamically loaded here -->
                    </div>
                </div>
                
                <div class="suggestions-section">
                    <h3>Your Friends</h3>
                    <div class="suggestions-grid" id="friendsGrid">
                        <!-- Friends will be dynamically loaded here -->
                    </div>
                </div>
                
                <div class="suggestions-section">
                    <h3>Suggested Friends</h3>
                    <div class="suggestions-grid" id="suggestedFriendsGrid">
                        <!-- Suggested friends will be dynamically loaded here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Profile Page -->
        <section id="profile" class="page">
            <div class="container">
                <div class="profile-card">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profileAvatar">
                            U
                            <div class="profile-avatar-upload" id="profileAvatarUpload">
                                <i class="fas fa-camera"></i>
                            </div>
                            <input type="file" id="profilePictureUpload" class="profile-picture-upload" accept="image/*">
                        </div>
                        <div class="profile-details">
                            <h2 id="profileName">User Name</h2>
                            <p id="profileEmail">user@example.com</p>
                            <p id="profileJoinDate">Member since January 2023</p>
                            <div class="user-actions">
                                <button class="follow-btn" id="profileFollowBtn" style="display: none;">Follow</button>
                                <button class="friend-btn" id="profileFriendBtn" style="display: none;">Add Friend</button>
                                <button class="message-btn" id="profileMessageBtn" style="display: none;">Message</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-bio">
                        <h3>About Me</h3>
                        <p id="profileBio">This is where the user's bio will appear. They can edit this in their settings.</p>
                    </div>
                    
                    <div class="profile-stats">
                        <div class="stat">
                            <div class="stat-value" id="profileArticlesCount">12</div>
                            <div class="stat-label">Articles</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="profileFollowersCount">356</div>
                            <div class="stat-label">Followers</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="profileFollowingCount">124</div>
                            <div class="stat-label">Following</div>
                        </div>
                    </div>
                    
                    <div class="profile-articles">
                        <h3>My Articles</h3>
                        <div class="articles-grid" id="profileArticles">
                            <!-- User's articles will be dynamically loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Settings Page -->
        <section id="settings" class="page">
            <div class="container">
                <div class="settings-card">
                    <h2 class="section-title">Settings</h2>
                    
                    <div class="settings-group">
                        <h3>Personal Information</h3>
                        <div class="form-group">
                            <label for="settingsName">Full Name</label>
                            <input type="text" id="settingsName" placeholder="Enter your full name">
                        </div>
                        <div class="form-group">
                            <label for="settingsEmail">Email</label>
                            <input type="email" id="settingsEmail" placeholder="Enter your email">
                        </div>
                        <div class="form-group">
                            <label for="settingsBio">Bio</label>
                            <textarea id="settingsBio" placeholder="Tell us about yourself" rows="3"></textarea>
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <h3>Profile Picture</h3>
                        <div class="form-group">
                            <label for="settingsProfilePicture">Upload Profile Picture</label>
                            <input type="file" id="settingsProfilePicture" accept="image/*">
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <h3>Theme</h3>
                        <div class="setting-item">
                            <span>Dark Mode</span>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <h3>Account Settings</h3>
                        <div class="setting-item">
                            <span>Email Notifications</span>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <span>Push Notifications</span>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <span>Newsletter Subscription</span>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <h3>Privacy</h3>
                        <div class="setting-item">
                            <span>Public Profile</span>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <span>Show Email</span>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <span>Allow Direct Messages</span>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <button class="auth-btn" id="saveProfileBtn">Save Changes</button>
                    
                    <div class="logout-section">
                        <button class="logout-btn-settings" id="logoutBtnSettings">Logout</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container footer-content">
            <div class="social-links">
                <a href="https://www.instagram.com/bloghub7/" class="social-link">
                    <i class="fab fa-instagram"></i>
                </a>
                <a href="https://www.facebook.com/profile.php?id=61573912779133" class="social-link">
                    <i class="fab fa-facebook-f"></i>
                </a>
                <a href="https://www.youtube.com/@Why-o2j" class="social-link" target="_blank">
                    <i class="fab fa-youtube"></i>
                </a>
                
            </div>
            <div class="copyright">
                <p>&copy; 2023 BlogHub. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script type="module">
        // Import Firebase v11 Modular SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword, 
            createUserWithEmailAndPassword,
            signInWithPopup,
            GoogleAuthProvider,
            FacebookAuthProvider,
            onAuthStateChanged,
            signOut,
            updateProfile
        } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            doc, 
            setDoc, 
            getDoc, 
            updateDoc,
            addDoc,
            query,
            where,
            getDocs,
            onSnapshot,
            orderBy,
            serverTimestamp,
            deleteDoc,
            increment
        } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";
        import { 
            getStorage,
            ref,
            uploadBytes,
            getDownloadURL
        } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-storage.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB5o_yjIq0_CNLYwsCtDTWRs0cIKhI8tlI",
            authDomain: "bloghub-cbcc4.firebaseapp.com",
            projectId: "bloghub-cbcc4",
            storageBucket: "bloghub-cbcc4.firebasestorage.app",
            messagingSenderId: "103514268951",
            appId: "1:103514268951:web:12ecf3c88e5672217e0352"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // DOM Elements
        const authPage = document.getElementById('auth');
        const homePage = document.getElementById('home');
        const aboutPage = document.getElementById('about');
        const articlesPage = document.getElementById('articles');
        const createArticlePage = document.getElementById('create-article');
        const articleDetailPage = document.getElementById('article-detail');
        const connectPage = document.getElementById('connect');
        const friendsPage = document.getElementById('friends');
        const profilePage = document.getElementById('profile');
        const settingsPage = document.getElementById('settings');
        const userInfo = document.getElementById('userInfo');
        const userAvatar = document.getElementById('userAvatar');
        const profileAvatar = document.getElementById('profileAvatar');
        const profileAvatarUpload = document.getElementById('profileAvatarUpload');
        const profilePictureUpload = document.getElementById('profilePictureUpload');
        const settingsProfilePicture = document.getElementById('settingsProfilePicture');
        const profileName = document.getElementById('profileName');
        const profileEmail = document.getElementById('profileEmail');
        const profileBio = document.getElementById('profileBio');
        const profileJoinDate = document.getElementById('profileJoinDate');
        const profileArticlesCount = document.getElementById('profileArticlesCount');
        const profileFollowersCount = document.getElementById('profileFollowersCount');
        const profileFollowingCount = document.getElementById('profileFollowingCount');
        const profileFollowBtn = document.getElementById('profileFollowBtn');
        const profileFriendBtn = document.getElementById('profileFriendBtn');
        const profileMessageBtn = document.getElementById('profileMessageBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const logoutBtnSettings = document.getElementById('logoutBtnSettings');
        const createArticleBtn = document.getElementById('createArticleBtn');
        const authTabs = document.querySelectorAll('.auth-tab');
        const authForms = document.querySelectorAll('.auth-form');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const createArticleForm = document.getElementById('createArticleForm');
        const googleLoginBtn = document.getElementById('googleLogin');
        const facebookLoginBtn = document.getElementById('facebookLogin');
        const navLinks = document.querySelectorAll('.nav-link');
        const featuredArticlesGrid = document.getElementById('featuredArticles');
        const allArticlesGrid = document.getElementById('allArticles');
        const profileArticlesGrid = document.getElementById('profileArticles');
        const searchInput = document.getElementById('searchInput');
        const usersContainer = document.getElementById('usersContainer');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const chatSend = document.getElementById('chatSend');
        const chatUserName = document.getElementById('chatUserName');
        const chatUserAvatar = document.getElementById('chatUserAvatar');
        const saveProfileBtn = document.getElementById('saveProfileBtn');
        const settingsName = document.getElementById('settingsName');
        const settingsEmail = document.getElementById('settingsEmail');
        const settingsBio = document.getElementById('settingsBio');
        const suggestionsSection = document.getElementById('suggestionsSection');
        const suggestionsGrid = document.getElementById('suggestionsGrid');
        const followedUsersGrid = document.getElementById('followedUsersGrid');
        const messageNotification = document.getElementById('messageNotification');
        const mobileMessageNotification = document.getElementById('mobileMessageNotification');
        const friendRequestNotification = document.getElementById('friendRequestNotification');
        const mobileFriendRequestNotification = document.getElementById('mobileFriendRequestNotification');
        const likeBtn = document.getElementById('likeBtn');
        const commentInput = document.getElementById('commentInput');
        const commentRating = document.getElementById('commentRating');
        const commentSubmit = document.getElementById('commentSubmit');
        const detailReadCount = document.getElementById('detailReadCount');
        const detailLikeCount = document.getElementById('detailLikeCount');
        const detailCommentCount = document.getElementById('detailCommentCount');
        const friendRequestsList = document.getElementById('friendRequestsList');
        const friendsGrid = document.getElementById('friendsGrid');
        const suggestedFriendsGrid = document.getElementById('suggestedFriendsGrid');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileNav = document.getElementById('mobileNav');
        const articleTitle = document.getElementById('articleTitle');
        const articleCategory = document.getElementById('articleCategory');
        const articleImage = document.getElementById('articleImage');
        const articleExcerpt = document.getElementById('articleExcerpt');
        const articleContent = document.getElementById('articleContent');
        const articleTags = document.getElementById('articleTags');
        const tagsList = document.getElementById('tagsList');

        // Current User and Selected Chat User
        let currentUser = null;
        let selectedChatUser = null;
        let currentArticleId = null;
        let selectedRating = 0;
        let userFollowing = [];
        let userFriends = [];
        let friendRequests = [];
        let unreadMessages = 0;
        let unreadFriendRequests = 0;
        let allUsers = [];
        let conversations = {};
        let conversationListeners = {};
        let articles = [];
        let articleTagsArray = [];

        // Initialize the app
        function initApp() {
            // Check if user is logged in using modular auth
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    // User is signed in
                    currentUser = user;
                    showMainPages();
                    updateUserInfo(user);
                    loadUserProfile(user);
                    loadUserFollowing(user);
                    loadUserFriends(user);
                    loadFriendRequests(user);
                    checkFirstTimeUser(user);
                    loadUnreadMessages(user);
                    loadUnreadFriendRequests(user);
                    loadAllUsers();
                    loadArticles();
                } else {
                    // User is signed out
                    currentUser = null;
                    showAuthPage();
                }
            });

            // Set up event listeners
            setupEventListeners();
            
            // Render users for connect page
            renderUsers();
        }

        // Set up event listeners
        function setupEventListeners() {
            // Mobile menu toggle
            mobileMenuBtn.addEventListener('click', () => {
                mobileNav.classList.toggle('active');
            });

            // Close mobile menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!mobileNav.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                    mobileNav.classList.remove('active');
                }
            });

            // Create article button
            createArticleBtn.addEventListener('click', () => {
                showPage('create-article');
            });

            // Auth tab switching
            authTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    
                    // Update active tab
                    authTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show corresponding form
                    authForms.forEach(form => {
                        form.classList.remove('active');
                        if (form.id === `${tabName}Form`) {
                            form.classList.add('active');
                        }
                    });
                });
            });

            // Login form submission - MODULAR VERSION
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                try {
                    const userCredential = await signInWithEmailAndPassword(auth, email, password);
                    console.log('User logged in:', userCredential.user);
                } catch (error) {
                    console.error('Login error:', error);
                    alert('Login failed: ' + error.message);
                }
            });

            // Signup form submission - MODULAR VERSION
            signupForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = document.getElementById('signupName').value;
                const email = document.getElementById('signupEmail').value;
                const password = document.getElementById('signupPassword').value;
                const bio = document.getElementById('signupBio').value;
                
                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    console.log('User signed up:', userCredential.user);
                    
                    // Update profile with display name
                    await updateProfile(userCredential.user, {
                        displayName: name
                    });
                    
                    // Save additional user data to Firestore using modular syntax
                    await setDoc(doc(db, 'users', userCredential.user.uid), {
                        name: name,
                        email: email,
                        bio: bio,
                        joinDate: new Date().toISOString(),
                        articles: 0,
                        followers: 0,
                        following: 0,
                        friends: 0,
                        firstTimeUser: true,
                        profilePicture: ''
                    });
                    
                    console.log('User data saved to Firestore');
                } catch (error) {
                    console.error('Signup error:', error);
                    alert('Signup failed: ' + error.message);
                }
            });

            // Create article form submission
            createArticleForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                await publishArticle();
            });

            // Tags input functionality
            articleTags.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ',') {
                    e.preventDefault();
                    addTag(articleTags.value.trim());
                    articleTags.value = '';
                }
            });

            // Google login - MODULAR VERSION
            googleLoginBtn.addEventListener('click', async () => {
                const provider = new GoogleAuthProvider();
                try {
                    const result = await signInWithPopup(auth, provider);
                    console.log('Google login successful:', result.user);
                    
                    // Check if user exists in Firestore, if not create a record
                    const userRef = doc(db, 'users', result.user.uid);
                    const userDoc = await getDoc(userRef);
                    
                    if (!userDoc.exists()) {
                        await setDoc(userRef, {
                            name: result.user.displayName,
                            email: result.user.email,
                            bio: '',
                            joinDate: new Date().toISOString(),
                            articles: 0,
                            followers: 0,
                            following: 0,
                            friends: 0,
                            firstTimeUser: true,
                            profilePicture: result.user.photoURL || ''
                        });
                    }
                } catch (error) {
                    console.error('Google login error:', error);
                    alert('Google login failed: ' + error.message);
                }
            });

            // Facebook login - MODULAR VERSION
            facebookLoginBtn.addEventListener('click', async () => {
                const provider = new FacebookAuthProvider();
                try {
                    const result = await signInWithPopup(auth, provider);
                    console.log('Facebook login successful:', result.user);
                    
                    // Check if user exists in Firestore, if not create a record
                    const userRef = doc(db, 'users', result.user.uid);
                    const userDoc = await getDoc(userRef);
                    
                    if (!userDoc.exists()) {
                        await setDoc(userRef, {
                            name: result.user.displayName,
                            email: result.user.email,
                            bio: '',
                            joinDate: new Date().toISOString(),
                            articles: 0,
                            followers: 0,
                            following: 0,
                            friends: 0,
                            firstTimeUser: true,
                            profilePicture: result.user.photoURL || ''
                        });
                    }
                } catch (error) {
                    console.error('Facebook login error:', error);
                    alert('Facebook login failed: ' + error.message);
                }
            });

            // Logout - MODULAR VERSION
            logoutBtn.addEventListener('click', async () => {
                try {
                    await signOut(auth);
                    console.log('User signed out');
                } catch (error) {
                    console.error('Logout error:', error);
                }
            });

            // Logout from settings - MODULAR VERSION
            logoutBtnSettings.addEventListener('click', async () => {
                try {
                    await signOut(auth);
                    console.log('User signed out');
                } catch (error) {
                    console.error('Logout error:', error);
                }
            });

            // Navigation
            navLinks.forEach(link => {
                link.addEventListener('click', e => {
                    e.preventDefault();
                    const page = link.getAttribute('data-page');
                    showPage(page);
                    mobileNav.classList.remove('active');
                });
            });

            // Search functionality
            searchInput.addEventListener('input', filterArticles);

            // Chat functionality
            chatSend.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', e => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // Save profile changes - MODULAR VERSION
            saveProfileBtn.addEventListener('click', async () => {
                if (!currentUser) return;
                
                const name = settingsName.value;
                const email = settingsEmail.value;
                const bio = settingsBio.value;
                
                try {
                    // Update auth profile
                    await updateProfile(currentUser, {
                        displayName: name
                    });
                    
                    // Update Firestore
                    const userRef = doc(db, 'users', currentUser.uid);
                    await updateDoc(userRef, {
                        name: name,
                        email: email,
                        bio: bio
                    });
                    
                    // Handle profile picture upload
                    const profilePictureFile = settingsProfilePicture.files[0];
                    if (profilePictureFile) {
                        await uploadProfilePicture(profilePictureFile);
                    }
                    
                    alert('Profile updated successfully!');
                    loadUserProfile(currentUser);
                } catch (error) {
                    console.error('Error updating profile:', error);
                    alert('Error updating profile: ' + error.message);
                }
            });

            // Profile avatar upload
            profileAvatarUpload.addEventListener('click', () => {
                profilePictureUpload.click();
            });
            
            profilePictureUpload.addEventListener('change', async (e) => {
                if (e.target.files[0]) {
                    await uploadProfilePicture(e.target.files[0]);
                }
            });

            // Like button
            likeBtn.addEventListener('click', toggleLike);

            // Comment rating stars
            commentRating.addEventListener('click', e => {
                if (e.target.classList.contains('comment-star')) {
                    const rating = parseInt(e.target.getAttribute('data-rating'));
                    setCommentRating(rating);
                }
            });

            // Comment submission
            commentSubmit.addEventListener('click', submitComment);

            // Follow button
            profileFollowBtn.addEventListener('click', toggleFollow);

            // Friend button
            profileFriendBtn.addEventListener('click', toggleFriendRequest);

            // Message button
            profileMessageBtn.addEventListener('click', () => {
                if (selectedChatUser) {
                    showPage('connect');
                    setTimeout(() => {
                        selectUser(selectedChatUser);
                    }, 100);
                }
            });
        }

        // Add tag to article
        function addTag(tagText) {
            if (tagText && !articleTagsArray.includes(tagText)) {
                articleTagsArray.push(tagText);
                renderTags();
            }
        }

        // Remove tag from article
        function removeTag(tagText) {
            articleTagsArray = articleTagsArray.filter(tag => tag !== tagText);
            renderTags();
        }

        // Render tags
        function renderTags() {
            tagsList.innerHTML = '';
            articleTagsArray.forEach(tag => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag';
                tagElement.innerHTML = `
                    ${tag}
                    <span class="tag-remove" data-tag="${tag}">&times;</span>
                `;
                tagsList.appendChild(tagElement);
            });

            // Add event listeners to remove buttons
            document.querySelectorAll('.tag-remove').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const tag = e.target.getAttribute('data-tag');
                    removeTag(tag);
                });
            });
        }

        // Publish article to Firebase
        async function publishArticle() {
            if (!currentUser) {
                alert('Please log in to publish articles');
                return;
            }

            const title = articleTitle.value.trim();
            const category = articleCategory.value;
            const image = articleImage.value.trim();
            const excerpt = articleExcerpt.value.trim();
            const content = articleContent.value.trim();
            const tags = articleTagsArray;

            if (!title || !category || !excerpt || !content) {
                alert('Please fill in all required fields');
                return;
            }

            try {
                // Create article in Firestore
                const articleRef = await addDoc(collection(db, 'articles'), {
                    title: title,
                    category: category,
                    image: image || 'https://images.unsplash.com/photo-1486312338219-ce68d2c6f44d?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80',
                    excerpt: excerpt,
                    content: content,
                    tags: tags,
                    authorId: currentUser.uid,
                    authorName: currentUser.displayName || 'Anonymous',
                    publishedAt: serverTimestamp(),
                    readCount: 0,
                    likeCount: 0,
                    commentCount: 0,
                    rating: 0,
                    ratingCount: 0
                });

                // Update user's article count
                const userRef = doc(db, 'users', currentUser.uid);
                await updateDoc(userRef, {
                    articles: increment(1)
                });

                // Clear form
                createArticleForm.reset();
                articleTagsArray = [];
                renderTags();

                alert('Article published successfully!');
                showPage('articles');
                
                // Reload articles to show the new one
                loadArticles();
            } catch (error) {
                console.error('Error publishing article:', error);
                alert('Error publishing article: ' + error.message);
            }
        }

        // Load articles from Firebase
        async function loadArticles() {
            try {
                const articlesRef = collection(db, 'articles');
                const q = query(articlesRef, orderBy('publishedAt', 'desc'));
                const snapshot = await getDocs(q);
                
                articles = [];
                snapshot.forEach(doc => {
                    const articleData = doc.data();
                    articles.push({
                        id: doc.id,
                        ...articleData,
                        // Convert Firestore timestamp to Date
                        date: articleData.publishedAt ? 
                            articleData.publishedAt.toDate().toLocaleDateString() : 
                            new Date().toLocaleDateString()
                    });
                });
                
                renderArticles();
            } catch (error) {
                console.error('Error loading articles:', error);
            }
        }

        // Upload profile picture
        async function uploadProfilePicture(file) {
            if (!currentUser) return;
            
            try {
                // Create a reference to the file location
                const storageRef = ref(storage, `profile-pictures/${currentUser.uid}`);
                
                // Upload the file
                const snapshot = await uploadBytes(storageRef, file);
                
                // Get the download URL
                const downloadURL = await getDownloadURL(snapshot.ref);
                
                // Update user profile with the new photo URL
                await updateProfile(currentUser, {
                    photoURL: downloadURL
                });
                
                // Update Firestore
                const userRef = doc(db, 'users', currentUser.uid);
                await updateDoc(userRef, {
                    profilePicture: downloadURL
                });
                
                // Update UI
                updateUserInfo(currentUser);
                
                alert('Profile picture updated successfully!');
            } catch (error) {
                console.error('Error uploading profile picture:', error);
                alert('Error uploading profile picture: ' + error.message);
            }
        }

        // Show authentication page
        function showAuthPage() {
            authPage.classList.add('active');
            homePage.classList.remove('active');
            aboutPage.classList.remove('active');
            articlesPage.classList.remove('active');
            createArticlePage.classList.remove('active');
            articleDetailPage.classList.remove('active');
            connectPage.classList.remove('active');
            friendsPage.classList.remove('active');
            profilePage.classList.remove('active');
            settingsPage.classList.remove('active');
            userInfo.style.display = 'none';
        }

        // Show main pages after login
        function showMainPages() {
            authPage.classList.remove('active');
            homePage.classList.add('active');
            userInfo.style.display = 'flex';
        }

        // Show specific page
        function showPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show the selected page
            document.getElementById(pageName).classList.add('active');
            
            // If showing connect page, initialize chat
            if (pageName === 'connect') {
                initializeChat();
                renderFollowedUsers();
            }
            
            // If showing friends page, load friend data
            if (pageName === 'friends') {
                renderFriends();
                renderSuggestedFriends();
            }
            
            // If showing profile page, check if it's the current user's profile
            if (pageName === 'profile') {
                if (currentUser) {
                    // It's the current user's profile
                    profileFollowBtn.style.display = 'none';
                    profileFriendBtn.style.display = 'none';
                    profileMessageBtn.style.display = 'none';
                    loadUserArticles(currentUser.uid);
                }
            }
            
            // If showing articles page, load all articles
            if (pageName === 'articles') {
                loadArticles();
            }
        }

        // Update user information in the UI
        function updateUserInfo(user) {
            const displayName = user.displayName || 'User';
            const email = user.email || 'user@example.com';
            const photoURL = user.photoURL || '';
            const firstLetter = displayName.charAt(0).toUpperCase();
            
            userAvatar.textContent = photoURL ? '' : firstLetter;
            userAvatar.style.backgroundImage = photoURL ? `url(${photoURL})` : '';
            
            profileAvatar.textContent = photoURL ? '' : firstLetter;
            profileAvatar.style.backgroundImage = photoURL ? `url(${photoURL})` : '';
            
            profileName.textContent = displayName;
            profileEmail.textContent = email;
        }

        // Load user profile from Firestore - MODULAR VERSION
        async function loadUserProfile(user) {
            try {
                const userRef = doc(db, 'users', user.uid);
                const userDoc = await getDoc(userRef);
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    profileName.textContent = userData.name || user.displayName || 'User';
                    profileBio.textContent = userData.bio || 'This is where the user\'s bio will appear. They can edit this in their settings.';
                    profileArticlesCount.textContent = userData.articles || 0;
                    profileFollowersCount.textContent = userData.followers || 0;
                    profileFollowingCount.textContent = userData.following || 0;
                    
                    if (userData.joinDate) {
                        const joinDate = new Date(userData.joinDate);
                        profileJoinDate.textContent = `Member since ${joinDate.toLocaleString('default', { month: 'long' })} ${joinDate.getFullYear()}`;
                    }
                    
                    // Update settings form
                    settingsName.value = userData.name || user.displayName || '';
                    settingsEmail.value = userData.email || user.email || '';
                    settingsBio.value = userData.bio || '';
                    
                    // Update profile picture if available
                    if (userData.profilePicture) {
                        userAvatar.style.backgroundImage = `url(${userData.profilePicture})`;
                        userAvatar.textContent = '';
                        profileAvatar.style.backgroundImage = `url(${userData.profilePicture})`;
                        profileAvatar.textContent = '';
                    }
                }
            } catch (error) {
                console.error('Error loading user profile:', error);
            }
        }

        // Load user's articles
        async function loadUserArticles(userId) {
            try {
                const articlesRef = collection(db, 'articles');
                const q = query(articlesRef, where('authorId', '==', userId), orderBy('publishedAt', 'desc'));
                const snapshot = await getDocs(q);
                
                const userArticles = [];
                snapshot.forEach(doc => {
                    const articleData = doc.data();
                    userArticles.push({
                        id: doc.id,
                        ...articleData,
                        date: articleData.publishedAt ? 
                            articleData.publishedAt.toDate().toLocaleDateString() : 
                            new Date().toLocaleDateString()
                    });
                });
                
                renderUserArticles(userArticles);
            } catch (error) {
                console.error('Error loading user articles:', error);
            }
        }

        // Render user's articles
        function renderUserArticles(userArticles) {
            profileArticlesGrid.innerHTML = '';
            
            if (userArticles.length === 0) {
                profileArticlesGrid.innerHTML = '<p>No articles published yet.</p>';
                return;
            }
            
            userArticles.forEach(article => {
                profileArticlesGrid.appendChild(createArticleCard(article));
            });
        }

        // Load all users from Firestore
        async function loadAllUsers() {
            try {
                const usersRef = collection(db, 'users');
                const snapshot = await getDocs(usersRef);
                allUsers = [];
                snapshot.forEach(doc => {
                    if (doc.id !== currentUser.uid) {
                        allUsers.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    }
                });
                renderUsers();
                renderUserSuggestions();
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        // Load user's following list - MODULAR VERSION
        async function loadUserFollowing(user) {
            try {
                const followingRef = collection(db, 'users', user.uid, 'following');
                const snapshot = await getDocs(followingRef);
                userFollowing = [];
                snapshot.forEach(doc => {
                    userFollowing.push(doc.id);
                });
            } catch (error) {
                console.error('Error loading following list:', error);
            }
        }

        // Load user's friends list - MODULAR VERSION
        async function loadUserFriends(user) {
            try {
                const friendsRef = collection(db, 'users', user.uid, 'friends');
                const snapshot = await getDocs(friendsRef);
                userFriends = [];
                snapshot.forEach(doc => {
                    userFriends.push(doc.id);
                });
            } catch (error) {
                console.error('Error loading friends list:', error);
            }
        }

        // Load friend requests - MODULAR VERSION
        async function loadFriendRequests(user) {
            try {
                const requestsRef = collection(db, 'friendRequests');
                const q = query(requestsRef, 
                    where('toUid', '==', user.uid),
                    where('status', '==', 'pending')
                );
                const snapshot = await getDocs(q);
                
                friendRequests = [];
                snapshot.forEach(doc => {
                    friendRequests.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                renderFriendRequests();
            } catch (error) {
                console.error('Error loading friend requests:', error);
            }
        }

        // Send friend request - MODULAR VERSION
        async function sendFriendRequest(toUid) {
            if (!currentUser) {
                alert("Login first!");
                return;
            }

            try {
                await addDoc(collection(db, "friendRequests"), {
                    fromUid: currentUser.uid,
                    toUid: toUid,
                    status: "pending",
                    timestamp: Date.now()
                });

                alert("Friend request sent!");
                
                // Update UI
                const friendBtn = document.querySelector(`.friend-btn[data-id="${toUid}"]`);
                if (friendBtn) {
                    friendBtn.textContent = 'Request Sent';
                    friendBtn.classList.add('requested');
                    friendBtn.disabled = true;
                }
            } catch (error) {
                console.error("Error sending friend request:", error);
                alert("Failed to send friend request: " + error.message);
            }
        }

        // Follow user - MODULAR VERSION
        async function followUser(userId) {
            if (!currentUser) return;
            
            try {
                // Add to following list
                await setDoc(doc(db, 'users', currentUser.uid, 'following', userId), {
                    timestamp: serverTimestamp()
                });
                
                // Add to user's followers list
                await setDoc(doc(db, 'users', userId, 'followers', currentUser.uid), {
                    timestamp: serverTimestamp()
                });
                
                // Update userFollowing array
                userFollowing.push(userId);
                
                // Update UI
                const followBtn = document.querySelector(`.follow-btn[data-id="${userId}"]`);
                if (followBtn) {
                    followBtn.textContent = 'Following';
                    followBtn.classList.add('following');
                }
                
                // Show success message
                alert('You are now following this user!');
            } catch (error) {
                console.error('Error following user:', error);
                alert('Error following user: ' + error.message);
            }
        }

        // Unfollow user - MODULAR VERSION
        async function unfollowUser(userId) {
            if (!currentUser) return;
            
            try {
                // Remove from following list
                await deleteDoc(doc(db, 'users', currentUser.uid, 'following', userId));
                
                // Remove from user's followers list
                await deleteDoc(doc(db, 'users', userId, 'followers', currentUser.uid));
                
                // Update userFollowing array
                const index = userFollowing.indexOf(userId);
                if (index > -1) {
                    userFollowing.splice(index, 1);
                }
                
                // Update UI
                const followBtn = document.querySelector(`.follow-btn[data-id="${userId}"]`);
                if (followBtn) {
                    followBtn.textContent = 'Follow';
                    followBtn.classList.remove('following');
                }
                
                // Show success message
                alert('You have unfollowed this user.');
            } catch (error) {
                console.error('Error unfollowing user:', error);
                alert('Error unfollowing user: ' + error.message);
            }
        }

        // Enhanced messaging system - MODULAR VERSION
        function setupRealTimeMessages(conversationId) {
            // Remove existing listener if any
            if (conversationListeners[conversationId]) {
                conversationListeners[conversationId]();
            }
            
            const messagesRef = collection(db, "messages");
            const q = query(messagesRef, 
                where("conversationId", "==", conversationId),
                orderBy("timestamp")
            );

            // Real-time listener for messages
            const unsubscribe = onSnapshot(q, (snapshot) => {
                const messages = [];
                snapshot.forEach(doc => {
                    messages.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                displayMessages(messages);
            });
            
            // Store the unsubscribe function
            conversationListeners[conversationId] = unsubscribe;
        }

        async function sendMessageToFirestore(text, conversationId) {
            if (!currentUser) return;
            
            try {
                await addDoc(collection(db, "messages"), {
                    conversationId: conversationId,
                    senderUid: currentUser.uid,
                    message: text,
                    timestamp: serverTimestamp()
                });
            } catch (error) {
                console.error("Error sending message:", error);
            }
        }

        // Get or create conversation ID
        function getConversationId(user1, user2) {
            return [user1, user2].sort().join('_');
        }

        // Check if user is first-time user and show suggestions
        function checkFirstTimeUser(user) {
            // In a real app, you would check Firestore
            // For this demo, we'll show suggestions for all users
            suggestionsSection.style.display = 'block';
            renderUserSuggestions();
        }

        // Load unread messages count
        function loadUnreadMessages(user) {
            // In a real app, you would query Firestore for unread messages
            // For this demo, we'll use a simulated count
            unreadMessages = 3; // Simulated unread messages
            updateMessageNotification();
        }

        // Load unread friend requests count
        function loadUnreadFriendRequests(user) {
            // In a real app, you would query Firestore for unread friend requests
            // For this demo, we'll use a simulated count
            unreadFriendRequests = friendRequests.length;
            updateFriendRequestNotification();
        }

        // Update message notification badge
        function updateMessageNotification() {
            if (unreadMessages > 0) {
                messageNotification.textContent = unreadMessages;
                messageNotification.style.display = 'flex';
                mobileMessageNotification.textContent = unreadMessages;
                mobileMessageNotification.style.display = 'flex';
            } else {
                messageNotification.style.display = 'none';
                mobileMessageNotification.style.display = 'none';
            }
        }

        // Update friend request notification badge
        function updateFriendRequestNotification() {
            if (unreadFriendRequests > 0) {
                friendRequestNotification.textContent = unreadFriendRequests;
                friendRequestNotification.style.display = 'flex';
                mobileFriendRequestNotification.textContent = unreadFriendRequests;
                mobileFriendRequestNotification.style.display = 'flex';
            } else {
                friendRequestNotification.style.display = 'none';
                mobileFriendRequestNotification.style.display = 'none';
            }
        }

        // Render articles to the page
        function renderArticles() {
            // Clear existing articles
            featuredArticlesGrid.innerHTML = '';
            allArticlesGrid.innerHTML = '';
            
            // Render featured articles (first 3)
            articles.slice(0, 3).forEach(article => {
                featuredArticlesGrid.appendChild(createArticleCard(article));
            });
            
            // Render all articles
            articles.forEach(article => {
                allArticlesGrid.appendChild(createArticleCard(article));
            });
        }

        // Create article card element
        function createArticleCard(article) {
            const card = document.createElement('div');
            card.className = 'article-card';
            card.setAttribute('data-id', article.id);
            card.innerHTML = `
                <div class="article-img" style="background-image: url('${article.image}')"></div>
                <div class="article-content">
                    <h3>${article.title}</h3>
                    <div class="article-meta">
                        <span>${article.authorName}</span>
                        <span>${article.date}</span>
                    </div>
                    <p class="article-excerpt">${article.excerpt}</p>
                    <div class="engagement-metrics">
                        <div class="metric">
                            <div class="metric-value">${article.readCount || 0}</div>
                            <div class="metric-label">Reads</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${article.likeCount || 0}</div>
                            <div class="metric-label">Likes</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${article.commentCount || 0}</div>
                            <div class="metric-label">Comments</div>
                        </div>
                    </div>
                    <div class="article-actions">
                        <a href="#" class="read-more" data-id="${article.id}">Read More <i class="fas fa-arrow-right"></i></a>
                        <div class="rating">
                            ${createRatingStars(article.rating || 0)}
                        </div>
                    </div>
                </div>
            `;
            
            // Add click event to read more button
            const readMoreBtn = card.querySelector('.read-more');
            readMoreBtn.addEventListener('click', (e) => {
                e.preventDefault();
                showArticleDetail(article.id);
            });
            
            return card;
        }

        // Create rating stars
        function createRatingStars(rating) {
            let stars = '';
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 !== 0;
            
            for (let i = 0; i < fullStars; i++) {
                stars += '<i class="fas fa-star star active"></i>';
            }
            
            if (hasHalfStar) {
                stars += '<i class="fas fa-star-half-alt star active"></i>';
            }
            
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            for (let i = 0; i < emptyStars; i++) {
                stars += '<i class="far fa-star star"></i>';
            }
            
            return stars;
        }

        // Show article detail
        function showArticleDetail(articleId) {
            const article = articles.find(a => a.id === articleId);
            if (!article) return;
            
            currentArticleId = articleId;
            
            // Update article detail page
            document.getElementById('detailTitle').textContent = article.title;
            document.getElementById('detailAuthor').textContent = article.authorName;
            document.getElementById('detailDate').textContent = article.date;
            document.getElementById('detailCategory').textContent = article.category;
            document.getElementById('detailImage').style.backgroundImage = `url('${article.image}')`;
            document.getElementById('detailBody').innerHTML = article.content;
            detailReadCount.textContent = article.readCount || 0;
            detailLikeCount.textContent = article.likeCount || 0;
            detailCommentCount.textContent = article.commentCount || 0;
            
            // Update tags
            const tagsContainer = document.getElementById('detailTags');
            tagsContainer.innerHTML = '';
            if (article.tags && article.tags.length > 0) {
                article.tags.forEach(tag => {
                    const tagElement = document.createElement('span');
                    tagElement.className = 'tag';
                    tagElement.textContent = tag;
                    tagsContainer.appendChild(tagElement);
                });
            }
            
            // Update rating
            const ratingContainer = document.getElementById('detailRating');
            ratingContainer.innerHTML = createRatingStars(article.rating || 0);
            
            // Update rating count
            document.getElementById('detailRatingCount').textContent = `(${article.ratingCount || 0} ratings)`;
            
            // Reset comment rating
            setCommentRating(0);
            
            // Show article detail page
            showPage('article-detail');
            
            // Load comments
            loadComments(articleId);
            
            // Increment read count
            incrementReadCount(articleId);
        }

        // Increment article read count
        async function incrementReadCount(articleId) {
            try {
                const articleRef = doc(db, 'articles', articleId);
                await updateDoc(articleRef, {
                    readCount: increment(1)
                });
            } catch (error) {
                console.error('Error incrementing read count:', error);
            }
        }

        // Load comments for an article
        function loadComments(articleId) {
            // In a real app, you would fetch comments from a database
            // For this demo, we'll use sample comments
            const commentsList = document.getElementById('commentsList');
            commentsList.innerHTML = '';
            
            const sampleComments = [
                {
                    id: 1,
                    author: "Alex Johnson",
                    text: "This is a great article! Very informative and well-written.",
                    date: "2 days ago",
                    rating: 5
                },
                {
                    id: 2,
                    author: "Sarah Miller",
                    text: "I learned a lot from this. Thanks for sharing your insights!",
                    date: "1 day ago",
                    rating: 4
                }
            ];
            
            sampleComments.forEach(comment => {
                const commentElement = document.createElement('div');
                commentElement.className = 'comment';
                commentElement.innerHTML = `
                    <div class="comment-header">
                        <span class="comment-author">${comment.author}</span>
                        <span class="comment-date">${comment.date}</span>
                    </div>
                    <p class="comment-text">${comment.text}</p>
                    <div class="comment-rating">
                        <div class="comment-stars">
                            ${createRatingStars(comment.rating)}
                        </div>
                    </div>
                `;
                commentsList.appendChild(commentElement);
            });
        }

        // Filter articles based on search input
        function filterArticles() {
            const searchTerm = searchInput.value.toLowerCase();
            const filteredArticles = articles.filter(article => 
                article.title.toLowerCase().includes(searchTerm) || 
                article.excerpt.toLowerCase().includes(searchTerm) ||
                article.category.toLowerCase().includes(searchTerm) ||
                (article.tags && article.tags.some(tag => tag.toLowerCase().includes(searchTerm)))
            );
            
            // Clear existing articles
            allArticlesGrid.innerHTML = '';
            
            // Render filtered articles
            filteredArticles.forEach(article => {
                allArticlesGrid.appendChild(createArticleCard(article));
            });
        }

        // Render users for connect page
        function renderUsers() {
            usersContainer.innerHTML = '';
            
            allUsers.forEach(user => {
                const userElement = document.createElement('div');
                userElement.className = 'user-item';
                userElement.setAttribute('data-id', user.id);
                
                const firstLetter = user.name ? user.name.charAt(0).toUpperCase() : 'U';
                const profilePicture = user.profilePicture || '';
                
                userElement.innerHTML = `
                    <div class="user-avatar-small" style="background-image: ${profilePicture ? `url(${profilePicture})` : ''}">${profilePicture ? '' : firstLetter}</div>
                    <div class="user-details-small">
                        <h4>${user.name || 'User'}</h4>
                        <p>${user.bio || 'BlogHub user'}</p>
                    </div>
                `;
                
                userElement.addEventListener('click', () => {
                    selectUser(user);
                });
                
                usersContainer.appendChild(userElement);
            });
        }

        // Render user suggestions for first-time users
        function renderUserSuggestions() {
            suggestionsGrid.innerHTML = '';
            
            // Show first 4 users as suggestions
            allUsers.slice(0, 4).forEach(user => {
                const firstLetter = user.name ? user.name.charAt(0).toUpperCase() : 'U';
                const profilePicture = user.profilePicture || '';
                const isFollowing = userFollowing.includes(user.id);
                
                const suggestionElement = document.createElement('div');
                suggestionElement.className = 'suggestion-card';
                suggestionElement.innerHTML = `
                    <div class="suggestion-avatar" style="background-image: ${profilePicture ? `url(${profilePicture})` : ''}">${profilePicture ? '' : firstLetter}</div>
                    <h4>${user.name || 'User'}</h4>
                    <p>${user.bio || 'BlogHub user'}</p>
                    <div class="suggestion-stats">
                        <span>${user.followers || 0} followers</span>
                        <span>${user.articles || 0} articles</span>
                    </div>
                    <button class="follow-btn ${isFollowing ? 'following' : ''}" data-id="${user.id}">${isFollowing ? 'Following' : 'Follow'}</button>
                `;
                
                const followBtn = suggestionElement.querySelector('.follow-btn');
                followBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (isFollowing) {
                        unfollowUser(user.id);
                    } else {
                        followUser(user.id);
                    }
                });
                
                suggestionsGrid.appendChild(suggestionElement);
            });
        }

        // Render followed users
        function renderFollowedUsers() {
            followedUsersGrid.innerHTML = '';
            
            // Filter followed users from allUsers
            const followedUsers = allUsers.filter(user => userFollowing.includes(user.id));
            
            followedUsers.forEach(user => {
                const firstLetter = user.name ? user.name.charAt(0).toUpperCase() : 'U';
                const profilePicture = user.profilePicture || '';
                
                const followedUserElement = document.createElement('div');
                followedUserElement.className = 'suggestion-card';
                followedUserElement.innerHTML = `
                    <div class="suggestion-avatar" style="background-image: ${profilePicture ? `url(${profilePicture})` : ''}">${profilePicture ? '' : firstLetter}</div>
                    <h4>${user.name || 'User'}</h4>
                    <p>${user.bio || 'BlogHub user'}</p>
                    <div class="suggestion-stats">
                        <span>${user.followers || 0} followers</span>
                        <span>${user.articles || 0} articles</span>
                    </div>
                    <div class="user-actions">
                        <button class="message-btn" data-id="${user.id}">Message</button>
                        <button class="follow-btn following" data-id="${user.id}">Following</button>
                    </div>
                `;
                
                const messageBtn = followedUserElement.querySelector('.message-btn');
                messageBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    // Navigate to connect page and select this user
                    showPage('connect');
                    setTimeout(() => {
                        selectUser(user);
                    }, 100);
                });
                
                const followBtn = followedUserElement.querySelector('.follow-btn');
                followBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    unfollowUser(user.id);
                });
                
                followedUsersGrid.appendChild(followedUserElement);
            });
        }

        // Render friends
        function renderFriends() {
            friendsGrid.innerHTML = '';
            
            // Filter friends from allUsers
            const friends = allUsers.filter(user => userFriends.includes(user.id));
            
            friends.forEach(user => {
                const firstLetter = user.name ? user.name.charAt(0).toUpperCase() : 'U';
                const profilePicture = user.profilePicture || '';
                
                const friendElement = document.createElement('div');
                friendElement.className = 'suggestion-card';
                friendElement.innerHTML = `
                    <div class="suggestion-avatar" style="background-image: ${profilePicture ? `url(${profilePicture})` : ''}">${profilePicture ? '' : firstLetter}</div>
                    <h4>${user.name || 'User'}</h4>
                    <p>${user.bio || 'BlogHub user'}</p>
                    <div class="suggestion-stats">
                        <span>${user.followers || 0} followers</span>
                        <span>${user.articles || 0} articles</span>
                    </div>
                    <div class="user-actions">
                        <button class="message-btn" data-id="${user.id}">Message</button>
                        <button class="friend-btn" data-id="${user.id}">Unfriend</button>
                    </div>
                `;
                
                const messageBtn = friendElement.querySelector('.message-btn');
                messageBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    // Navigate to connect page and select this user
                    showPage('connect');
                    setTimeout(() => {
                        selectUser(user);
                    }, 100);
                });
                
                const unfriendBtn = friendElement.querySelector('.friend-btn');
                unfriendBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    unfriendUser(user.id);
                });
                
                friendsGrid.appendChild(friendElement);
            });
        }

        // Render suggested friends
        function renderSuggestedFriends() {
            suggestedFriendsGrid.innerHTML = '';
            
            // Filter users who are not friends and not in pending requests
            const suggestedFriends = allUsers.filter(user => 
                !userFriends.includes(user.id) && 
                !friendRequests.some(req => req.fromUid === user.id || req.toUid === user.id)
            ).slice(0, 3);
            
            suggestedFriends.forEach(user => {
                const firstLetter = user.name ? user.name.charAt(0).toUpperCase() : 'U';
                const profilePicture = user.profilePicture || '';
                
                const suggestionElement = document.createElement('div');
                suggestionElement.className = 'suggestion-card';
                suggestionElement.innerHTML = `
                    <div class="suggestion-avatar" style="background-image: ${profilePicture ? `url(${profilePicture})` : ''}">${profilePicture ? '' : firstLetter}</div>
                    <h4>${user.name || 'User'}</h4>
                    <p>${user.bio || 'BlogHub user'}</p>
                    <div class="suggestion-stats">
                        <span>${user.followers || 0} followers</span>
                        <span>${user.articles || 0} articles</span>
                    </div>
                    <button class="friend-btn" data-id="${user.id}">Add Friend</button>
                `;
                
                const friendBtn = suggestionElement.querySelector('.friend-btn');
                friendBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    sendFriendRequest(user.id);
                });
                
                suggestedFriendsGrid.appendChild(suggestionElement);
            });
        }

        // Render friend requests
        function renderFriendRequests() {
            friendRequestsList.innerHTML = '';
            
            if (friendRequests.length === 0) {
                friendRequestsList.innerHTML = '<p>No pending friend requests</p>';
                return;
            }
            
            friendRequests.forEach(request => {
                // Find the user who sent the request
                const fromUser = allUsers.find(user => user.id === request.fromUid);
                if (!fromUser) return;
                
                const firstLetter = fromUser.name ? fromUser.name.charAt(0).toUpperCase() : 'U';
                const profilePicture = fromUser.profilePicture || '';
                
                const requestElement = document.createElement('div');
                requestElement.className = 'friend-request-item';
                requestElement.innerHTML = `
                    <div class="friend-request-info">
                        <div class="user-avatar-small" style="background-image: ${profilePicture ? `url(${profilePicture})` : ''}">${profilePicture ? '' : firstLetter}</div>
                        <div>
                            <h4>${fromUser.name || 'User'}</h4>
                            <p>Wants to be your friend</p>
                        </div>
                    </div>
                    <div class="friend-request-actions">
                        <button class="accept-btn" data-id="${request.id}" data-userid="${fromUser.id}">Accept</button>
                        <button class="decline-btn" data-id="${request.id}">Decline</button>
                    </div>
                `;
                
                const acceptBtn = requestElement.querySelector('.accept-btn');
                acceptBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    acceptFriendRequest(request.id, fromUser.id);
                });
                
                const declineBtn = requestElement.querySelector('.decline-btn');
                declineBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    declineFriendRequest(request.id);
                });
                
                friendRequestsList.appendChild(requestElement);
            });
        }

        // Toggle follow status
        function toggleFollow() {
            if (!currentUser) {
                alert('Please log in to follow users');
                return;
            }
            
            const userId = selectedChatUser.id;
            const isFollowing = userFollowing.includes(userId);
            
            if (isFollowing) {
                unfollowUser(userId);
            } else {
                followUser(userId);
            }
        }

        // Accept friend request
        async function acceptFriendRequest(requestId, fromUid) {
            try {
                // Update friend request status
                await updateDoc(doc(db, 'friendRequests', requestId), {
                    status: 'accepted'
                });
                
                // Add to current user's friends
                await setDoc(doc(db, 'users', currentUser.uid, 'friends', fromUid), {
                    timestamp: serverTimestamp()
                });
                
                // Add to requester's friends
                await setDoc(doc(db, 'users', fromUid, 'friends', currentUser.uid), {
                    timestamp: serverTimestamp()
                });
                
                // Update local arrays
                userFriends.push(fromUid);
                
                // Remove from friend requests
                const index = friendRequests.findIndex(req => req.id === requestId);
                if (index > -1) {
                    friendRequests.splice(index, 1);
                }
                
                // Update UI
                renderFriendRequests();
                unreadFriendRequests--;
                updateFriendRequestNotification();
                
                // Show success message
                alert('Friend request accepted!');
            } catch (error) {
                console.error('Error accepting friend request:', error);
                alert('Error accepting friend request: ' + error.message);
            }
        }

        // Decline friend request
        async function declineFriendRequest(requestId) {
            try {
                // Update friend request status
                await updateDoc(doc(db, 'friendRequests', requestId), {
                    status: 'declined'
                });
                
                // Remove from friend requests
                const index = friendRequests.findIndex(req => req.id === requestId);
                if (index > -1) {
                    friendRequests.splice(index, 1);
                }
                
                // Update UI
                renderFriendRequests();
                unreadFriendRequests--;
                updateFriendRequestNotification();
                
                // Show success message
                alert('Friend request declined.');
            } catch (error) {
                console.error('Error declining friend request:', error);
                alert('Error declining friend request: ' + error.message);
            }
        }

        // Unfriend a user
        async function unfriendUser(userId) {
            if (!currentUser) return;
            
            try {
                // Remove from current user's friends
                await deleteDoc(doc(db, 'users', currentUser.uid, 'friends', userId));
                
                // Remove from user's friends
                await deleteDoc(doc(db, 'users', userId, 'friends', currentUser.uid));
                
                // Update local array
                const index = userFriends.indexOf(userId);
                if (index > -1) {
                    userFriends.splice(index, 1);
                }
                
                // Update UI
                renderFriends();
                
                // Show success message
                alert('You have unfriended this user.');
            } catch (error) {
                console.error('Error unfriending user:', error);
                alert('Error unfriending user: ' + error.message);
            }
        }

        // Toggle friend request
        function toggleFriendRequest() {
            if (!currentUser) {
                alert('Please log in to send friend requests');
                return;
            }
            
            const userId = selectedChatUser.id;
            const isFriend = userFriends.includes(userId);
            
            if (isFriend) {
                unfriendUser(userId);
            } else {
                sendFriendRequest(userId);
            }
        }

        // Initialize chat
        function initializeChat() {
            // Clear chat messages
            chatMessages.innerHTML = '';
            chatInput.disabled = true;
            chatSend.disabled = true;
            
            // Show default message
            const defaultMessage = document.createElement('div');
            defaultMessage.className = 'message';
            defaultMessage.textContent = 'Select a user to start chatting';
            defaultMessage.style.alignSelf = 'center';
            defaultMessage.style.textAlign = 'center';
            defaultMessage.style.width = 'auto';
            chatMessages.appendChild(defaultMessage);
        }

        // Select user for chat
        function selectUser(user) {
            selectedChatUser = user;
            
            // Update UI
            document.querySelectorAll('.user-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.user-item[data-id="${user.id}"]`).classList.add('active');
            
            // Update chat header
            chatUserName.textContent = user.name || 'User';
            
            const firstLetter = user.name ? user.name.charAt(0).toUpperCase() : 'U';
            const profilePicture = user.profilePicture || '';
            chatUserAvatar.textContent = profilePicture ? '' : firstLetter;
            chatUserAvatar.style.backgroundImage = profilePicture ? `url(${profilePicture})` : '';
            
            // Enable chat input
            chatInput.disabled = false;
            chatSend.disabled = false;
            
            // Update profile buttons
            profileFollowBtn.style.display = 'inline-block';
            profileFriendBtn.style.display = 'inline-block';
            profileMessageBtn.style.display = 'inline-block';
            
            // Update follow button state
            const isFollowing = userFollowing.includes(user.id);
            profileFollowBtn.textContent = isFollowing ? 'Following' : 'Follow';
            profileFollowBtn.classList.toggle('following', isFollowing);
            
            // Update friend button state
            const isFriend = userFriends.includes(user.id);
            const hasRequest = friendRequests.some(req => req.fromUid === user.id || req.toUid === user.id);
            profileFriendBtn.textContent = isFriend ? 'Unfriend' : (hasRequest ? 'Request Sent' : 'Add Friend');
            profileFriendBtn.classList.toggle('requested', hasRequest);
            
            // Load chat messages
            loadChatMessages(user.id);
        }

        // Load chat messages
        function loadChatMessages(userId) {
            // Clear chat messages
            chatMessages.innerHTML = '';
            
            // Get conversation ID
            const conversationId = getConversationId(currentUser.uid, userId);
            
            // Set up real-time listener for messages
            setupRealTimeMessages(conversationId);
        }

        // Display messages in the chat
        function displayMessages(messages) {
            // Clear chat messages
            chatMessages.innerHTML = '';
            
            if (messages.length === 0) {
                const defaultMessage = document.createElement('div');
                defaultMessage.className = 'message';
                defaultMessage.textContent = 'No messages yet. Start the conversation!';
                defaultMessage.style.alignSelf = 'center';
                defaultMessage.style.textAlign = 'center';
                defaultMessage.style.width = 'auto';
                chatMessages.appendChild(defaultMessage);
                return;
            }
            
            messages.forEach(message => {
                const messageElement = document.createElement('div');
                const isSent = message.senderUid === currentUser.uid;
                messageElement.className = `message ${isSent ? 'sent' : 'received'}`;
                
                const timestamp = message.timestamp ? message.timestamp.toDate() : new Date();
                const timeString = timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                messageElement.innerHTML = `
                    <div class="message-text">${message.message}</div>
                    <div class="message-time">${timeString}</div>
                `;
                
                chatMessages.appendChild(messageElement);
            });
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Send message
        async function sendMessage() {
            if (!selectedChatUser || !chatInput.value.trim()) return;
            
            const messageText = chatInput.value.trim();
            
            // Get conversation ID
            const conversationId = getConversationId(currentUser.uid, selectedChatUser.id);
            
            // Send message to Firestore
            await sendMessageToFirestore(messageText, conversationId);
            
            // Clear input
            chatInput.value = '';
        }

        // Toggle like on article
        function toggleLike() {
            if (!currentUser) {
                alert('Please log in to like articles');
                return;
            }
            
            const article = articles.find(a => a.id === currentArticleId);
            if (!article) return;
            
            // In a real app, you would update Firestore
            // For this demo, we'll update the UI immediately
            if (likeBtn.querySelector('i').classList.contains('far')) {
                // Like the article
                likeBtn.innerHTML = '<i class="fas fa-heart"></i> Liked';
                article.likeCount++;
                detailLikeCount.textContent = article.likeCount;
            } else {
                // Unlike the article
                likeBtn.innerHTML = '<i class="far fa-heart"></i> Like';
                article.likeCount--;
                detailLikeCount.textContent = article.likeCount;
            }
        }

        // Set comment rating
        function setCommentRating(rating) {
            selectedRating = rating;
            const stars = commentRating.querySelectorAll('.comment-star');
            
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.remove('far');
                    star.classList.add('fas');
                } else {
                    star.classList.remove('fas');
                    star.classList.add('far');
                }
            });
        }

        // Submit comment
        function submitComment() {
            if (!currentUser) {
                alert('Please log in to comment');
                return;
            }
            
            const commentText = commentInput.value.trim();
            if (!commentText) {
                alert('Please enter a comment');
                return;
            }
            
            if (selectedRating === 0) {
                alert('Please rate the article');
                return;
            }
            
            // In a real app, you would save the comment to Firestore
            // For this demo, we'll update the UI immediately
            
            // Create comment element
            const commentElement = document.createElement('div');
            commentElement.className = 'comment';
            
            const currentDate = new Date();
            const timeAgo = 'Just now';
            
            commentElement.innerHTML = `
                <div class="comment-header">
                    <span class="comment-author">${currentUser.displayName || 'You'}</span>
                    <span class="comment-date">${timeAgo}</span>
                </div>
                <p class="comment-text">${commentText}</p>
                <div class="comment-rating">
                    <div class="comment-stars">
                        ${createRatingStars(selectedRating)}
                    </div>
                </div>
            `;
            
            // Add comment to the list
            const commentsList = document.getElementById('commentsList');
            commentsList.insertBefore(commentElement, commentsList.firstChild);
            
            // Update comment count
            const article = articles.find(a => a.id === currentArticleId);
            if (article) {
                article.commentCount++;
                detailCommentCount.textContent = article.commentCount;
            }
            
            // Clear comment input and rating
            commentInput.value = '';
            setCommentRating(0);
            
            // Show success message
            alert('Comment added successfully!');
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>